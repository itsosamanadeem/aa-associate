<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="//table[@name='invoice_line_table']" position="replace">
            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
            <t t-foreach="lines" t-as="line">
                <table class="o_has_total_table table o_main_table table-borderless" name="invoice_line_ids">
                    <thead>
                        <tr>
                            <t t-set="headers" t-value="line.extra_flags.get(str(line.id))"/>
                            <t t-foreach="headers" t-as="header">
                                <th>
                                     <t t-esc="line.get_field_label(header)"/>
                                </th>
                            </t>
                        </tr>
                    </thead>
                    <tbody class="invoice_tbody">
                        <tr>
                            <t t-foreach="headers" t-as="header">
                                <td>
                                    <t t-if="line._fields.get(header) and line._fields.get(header).type == 'binary'">
                                        <img t-att-src="line.get_field_value(header)" style="height:80px; width:80px;"/>
                                    </t>
                                    <t t-else="">
                                        <t t-esc="line.get_field_value(header) or '-'"/>
                                    </t>
                                </td>
                            </t>
                        </tr>
                    </tbody>
                </table>
            </t>
        </xpath>
        <xpath expr="//div[@id='payment_term']" position="after">
            <div class="mt-5 clearfix overflow-auto" style="border: 1px solid #dee2e6; border-radius: 6px; padding: 10px; width: 100% !important;">
                <table class="o_has_total_table table o_main_table table-borderless">
                    <thead>
                        <tr>
                            <strong style="color:#4e4e4e; font-size:14px;">Descriptions</strong>
                        </tr>
                    </thead>
                    <t t-set="professional_fee_line" 
                       t-value="o.invoice_line_ids.filtered(lambda l: l.product_id.name == 'Professional Fees')[:1]"/>
                    
                    <tbody class="invoice_tbody">
                        <t t-foreach="lines" t-as="line">
                            <tr>
                                <td>
                                    <div style="margin-bottom:6px; padding:6px 10px; border-bottom:1px solid #e9ecef;">
                                        <span style="font-weight:10; color:#212529;" t-out="line.name"/> :
                                        <small style="color:#6c757d;">
                                            <em t-out="line.product_id.product_tmpl_id.description_purchase"/>
                                        </small>
                                        <br/>
                                    </div>
                                </td>
                                <td>
                                    <t t-set="class_count" t-value="len(line.selected_variant_names or [])"/>
                                    <t t-set="unit_price" 
                                       t-value="professional_fee_line.price_unit if professional_fee_line else line.price_unit"/>
                                    <t t-set="fee_total" t-value="class_count * unit_price"/>
                                    <t t-if="class_count != 0">
                                        <span>
                                            <t t-esc="unit_price"/> * <t t-esc="class_count"/> = <t t-esc="fee_total"/>
                                        </span>
                                    </t>
                                    <t t-else="">
                                        <span><t t-esc="unit_price"/></span>
                                    </t>
                                </td>
                            </tr>
                        </t>
                    </tbody>

                </table>
            </div>
        </xpath>
    </template>
</odoo>